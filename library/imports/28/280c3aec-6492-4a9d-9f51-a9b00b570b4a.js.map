{"version":3,"sources":["../../../../assets/Script/assets/Script/main_scene.js"],"names":["cfg","GM","util","vm","cc","Class","extends","require","properties","top_prefab","Prefab","onLoad","_regEvts","_initPersist","_init","_test","onClickTest","event","custom","GM_DEBUG","log","params","vKey","data","EventCenter","trigger","EventType","GM_UI_REPLACE_FULL_VIEW","openPrefab","openQueuePrefab","listen","onPopView","tcfg","assetUrl","param","_pview","_checkFullView","vname","children","len","length","i","child","name","active","_bgsp","node","getChildByName","getComponent","Sprite","_replaceBg","spf","spriteFrame","instantiate","scene","getScene","zIndex","max_zindex","parent"],"mappings":"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","file":"main_scene.js","sourceRoot":"../../../../assets/Script","sourcesContent":["/*================================================================\n * FileName main_scene\n * Description 当前主场景\n * Created on 04/03/19 by ocean\n * Copyright (c) 2019 OCEAN\n================================================================*/\n/*\n*  GM: 全局\n*  GM.vm 视图管理\n*  GM.sm 声音管理\n*/\n// cfg.GM_DEBUG && cc.error(this.name);\nconst cfg = GM.cfg;\nconst util = GM.util;\nconst vm = GM.vm;\ncc.Class({\n    extends: require(\"CustomComponent\"),\n    properties: {\n        top_prefab:cc.Prefab,\n    },\n    onLoad () {\n        this._regEvts();\n        this._initPersist();\n        this._init();\n        this._test();\n    },\n    _test(){\n        // this.schedule(()=>{\n        //     let scene = util.getScene();\n        //     for(let i = 0; i < scene.children.length; i++){\n        //         cfg.GM_DEBUG && cc.error(this.name,scene.children[i].name,scene.children[i].zIndex);\n        //     }\n        // },3);\n        // vm.openPrefab('Prefabs/Shop/Shop_View',{'hi':1},parent);\n        // vm.openPrefab('Prefabs/Shop/Match_View',{'hi':1},parent);\n    },\n    onClickTest(event,custom){\n        cfg.GM_DEBUG && this.log('onClickTest',custom);\n        if(custom == 1){\n            let params = {vKey:'Shop_View',data:{'shop':1}};\n            GM.EventCenter.trigger(GM.EventType.GM_UI_REPLACE_FULL_VIEW,params);\n        }else if(custom == 2){\n        }else if(custom == 3){    \n        }else if(custom == 4){\n            vm.openPrefab('Prefabs/Pop/Hall_Pop_Confirm',{'hi':1});\n            vm.openQueuePrefab('Prefabs/Pop/Hall_Pop_Turn',{'hi':1});\n            vm.openQueuePrefab('Prefabs/Pop/Hall_Pop_Confirm',{'hi':1});\n            vm.openQueuePrefab('Prefabs/Pop/Hall_Pop_Turn',{'hi':1});\n            vm.openQueuePrefab('Prefabs/Pop/Hall_Pop_Activity',{'hi':1});\n        }\n    },\n    _regEvts(){\n        GM.EventCenter.listen(GM.EventType.GM_UI_REPLACE_FULL_VIEW, this.onPopView, this);\n    },\n\n\n    /*\n    *    显示全屏view {assetUrl:'',vKey:'',data:{}}\n    */\n    onPopView(params){\n        let tcfg = {\n            'Hall_View':'Prefabs/Hall/Hall_View',  // key node节点的名字 value 预制体地址\n            'Shop_View':'Prefabs/Shop/Shop_View',\n            'Match_View':'Prefabs/Match/Match_View',\n        };\n        let assetUrl = tcfg[params.vKey];\n        let param = params.data || {};\n        vm.openPrefab(assetUrl,param,this._pview,()=>{\n            this._checkFullView(params.vKey);\n        });\n        \n    },\n    _checkFullView(vname){\n        let children = this._pview.children;\n        let len = children.length;\n        if(len == 1){return;}\n        for(let i = 0; i < len; i++){\n            let child = children[i];\n            if(child.name == vname){\n                child.active = true;\n            }else{\n                child.active = false;\n            }\n        }\n    },\n\n    /*\n    *     scene 变量\n    */\n    _init(){\n        this._bgsp = this.node.getChildByName('bg_sp').getComponent(cc.Sprite);   // scene bg\n        this._pview = this.node.getChildByName('pop_view');                       // scene full view parent\n\n    },\n\n    /*\n    *    scene 更换背景\n    */\n    _replaceBg(spf){\n        this._bgsp.spriteFrame = spf;\n    },\n\n    /*\n    *    常驻点 层级最高    \n    */\n    _initPersist(){\n        let node = cc.instantiate(this.top_prefab);\n        let scene = util.getScene();\n        node.zIndex = util.max_zindex;\n        node.parent = scene;\n    },\n    // start () {},\n    // onEnable (){},\n    // onDestroy (){},\n    // onDisable(){},\n    // update (dt) {},\n    // 一些全局的通知 公告 应该属于scene\n});"]}