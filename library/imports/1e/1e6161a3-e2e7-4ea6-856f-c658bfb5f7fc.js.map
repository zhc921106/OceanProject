{"version":3,"sources":["../../../../../assets/Script/Comps/assets/Script/Comps/gm_util.js"],"names":["GM","EventCenter","events","listen","eName","handler","scope","push","ignore","fns","filter","fn","ignoreScope","obs","msg","trigger","eventName","params","cc","error","i","len","length","call","dumpAllEvts","EventType","GM_UI_LOADING_START","GM_UI_LOADING_END","TCP_ERROR","TCP_CLOSE","TCP_OPENED","TCP_RECONNECT","util","max_zindex","Math","pow","getScene","director","getRes","assetUrl","callback","prefab","loader","loadRes","Prefab","completedCount","totalCount","progress","err"],"mappings":"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","file":"gm_util.js","sourceRoot":"../../../../../assets/Script/Comps","sourcesContent":["GM.EventCenter = {\n\n    events : {},\n\n    listen : function(eName, handler, scope){\n        this.events[eName] = this.events[eName] || [];\n        this.events[eName].push({\n            scope: scope || this,\n            handler: handler\n        });\n    },\n\n    ignore : function(eName, handler, scope){\n        scope = scope || this;\n        let fns = this.events[eName];\n\n        if(!fns){\n            return;\n        }\n\n        this.events[eName] = fns.filter(function(fn){\n            return fn.scope!=scope || fn.handler!=handler;\n        });\n    },\n\n    ignoreScope : function (scope) {\n    \tlet obs;\n        for(let msg in this.events){\n            obs = this.events[msg];\n            if(obs){\n                this.events[msg] = obs.filter(function(fn){\n                    if(fn.scope != scope){\n                        return true;\n                    } else{\n                        return false;\n                    }\n                });\n            }\n        }\n    },\n\n    trigger : function(eventName, params){\n        let fns = this.events[eventName];\n        if(!fns){\n            cc.error('GM EventCenter no Listen:',eventName);\n            return;\n        }\n        let fn;\n        for(var i = 0,len = fns.length; i < len; i++){\n            fn = fns[i];\n            if(fn && fn.handler && typeof fn.handler == \"function\"){\n                fn.handler.call(fn.scope, params);\n            }\n        }\n    },\n    dumpAllEvts(){},\n};\nGM.EventType = {\n\t// 内部事件\n\tGM_UI_LOADING_START: 'gm_ui_loading_start', // UI加载等待开始\n\tGM_UI_LOADING_END: 'gm_ui_loading_end',     //       ...结束\n\n\t// tcp事件\n\tTCP_ERROR: 'tcp_error',\n    TCP_CLOSE: 'tcp_close',\n    TCP_OPENED: 'tcp_opened', // 连接建立好之后的回调\n    TCP_RECONNECT: 'tcp_reconnect',\n\t// 页面消息事件\n\t// 平台事件\n};\nlet util = {\n    // property\n    max_zindex:Math.pow(2, 15)-1000,\n    \n    // function\n    getScene(){\n        return cc.director.getScene();\n    },\n    getRes(assetUrl,callback){\n    \tlet prefab = cc.loader.getRes(assetUrl);\n    \tif(prefab){callback(prefab);return;}\n    \tcc.loader.loadRes(assetUrl,cc.Prefab,(completedCount, totalCount)=>{\n    \t\t// TODO 加载进度更新\n    \t\tGM.EventCenter.trigger(GM.EventType.GM_UI_LOADING_START,{progress:(completedCount / totalCount)});\n    \t},(err,prefab)=>{\n    \t\tGM.EventCenter.trigger(GM.EventType.GM_UI_LOADING_END);\n    \t\tif(err){ cc.error('util loadRes error:',err); return;}\n    \t\tcallback(prefab);\n    \t});\n    },\n\n};\nGM.util = util;\n/*\n    cc.js.formatStr.apply(null, arguments)\n\n*/"]}