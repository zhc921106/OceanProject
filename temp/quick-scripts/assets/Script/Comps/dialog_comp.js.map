{"version":3,"sources":["dialog_comp.js"],"names":["cc","Class","extends","Component","properties","isEmpty","default","tooltip","windNode","type","Node","animTime","Integer","_darkNode","_darkOpac","init","params","undefined","onLoad","node","dialog","_bgBox","_comp","_initBgbox","_initDark","error","box","getBoundingBox","getComponent","loadDone","prefab","isValid","instantiate","addChild","on","EventType","TOUCH_END","onTouchDarkNode","loader","getRes","loadRes","err","touch","loc","getLocation","comp","convertToNodeSpaceAR","contains","close","onEnable","scale","runAction","scaleTo","easing","easeBackOut","resetOpacity","opa","opacity"],"mappings":"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","file":"dialog_comp.js","sourceRoot":"../../../../../assets/Script/Comps","sourcesContent":["/*================================================================\n * FileName dialog_comp\n * Description 弹框统一设置\n * Created on 05/03/19 by ocean\n * Copyright (c) 2019 OCEAN\n================================================================*/\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        isEmpty: {\n            default: true,\n            tooltip: '是否点击空白处关闭',\n        },\n        windNode:{\n            default:null,\n            tooltip: '背景窗口节点',\n            type: cc.Node,\n        },\n        animTime:{\n            default:0,\n            tooltip: '背景弹窗动画时间',\n            type:cc.Integer\n        } ,\n        _darkNode:cc.Node,\n        _darkOpac:160,\n\n    },\n    init(params){\n        params.isEmpty != undefined && (this.isEmpty = params.isEmpty);\n    },\n    onLoad () {\n        this.node.dialog = this;// 重要\n        this._bgBox = null;\n        this._comp = null;\n        this._initBgbox();\n        this._initDark();        \n    },\n    _initBgbox(){\n        if(!this.windNode){ cc.error('dialog no windNode'); return;}\n        let box = this.windNode.getBoundingBox();\n        this._bgBox = box;\n        this._comp = this.node.getComponent('CustomComponent');\n    },\n    _initDark(){\n        let loadDone = (prefab)=>{\n            if(!cc.isValid(this.node)){cc.error('dialog this.node is destoryed'); return;}\n            let node = cc.instantiate(prefab);\n            this.node.addChild(node, -1);\n            this._darkNode = node;\n            node.on(cc.Node.EventType.TOUCH_END, this.onTouchDarkNode,this);\n        };\n        let prefab = cc.loader.getRes('Prefabs/Ui_Groups/dark_node');\n        if(prefab){\n            loadDone(prefab);\n        }else{\n            cc.loader.loadRes('Prefabs/Ui_Groups/dark_node',(err,prefab)=>{\n                if(err){ cc.error('dialog'+err); return;}\n                loadDone(prefab);\n            });\n        }\n    },\n    onTouchDarkNode(touch){\n        if(!this.isEmpty){return;}\n        if(!this.windNode){ cc.error('dialog no windNode'); return;}\n        let loc = touch.getLocation();\n        let box = this._bgBox;\n        let comp = this._comp;\n        loc = this.windNode.convertToNodeSpaceAR(loc);\n        if(!box.contains(loc)){\n            comp && comp.close();\n        }\n    },\n    // _regEvts(){},\n    // _close(){},\n    // start () {},\n    onEnable (){\n        if(this.animTime==0){return;}\n        this.windNode.scale = 0.5;\n        this.windNode.runAction(cc.scaleTo(this.animTime, 1).easing(cc.easeBackOut()));\n    },\n    resetOpacity(opa){\n        if(this._darkNode && cc.isValid(this._darkNode)){\n            opa = opa == undefined ? this._darkOpac : 0;\n            this._darkNode.opacity = opa;\n        }\n    },\n    // onDestroy (){},\n    // onDisable(){},\n    // update (dt) {},\n});"]}